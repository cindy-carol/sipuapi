<div class="mobile-spacer d-block d-md-none" style="height: 3.5rem;"></div>

<h1>Monitoring Pendaftaran Ujian Akhir Profesi</h1>

<div class="">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-2 mb-3">
    <form method="get" action="/admin/monitoring/export">
      <select name="tahun_ajaran" id="tahun_ajaran" class="form-select-sm" onchange="this.form.submit()">
        <option value="">Semua Tahun</option>
        <% tahunAjarList.forEach(t => { %>
        <option value="<%= t.id %>" <%= Number(selectedTahunId) === t.id ? 'selected' : '' %>>
          <%= t.label %>
        </option>
        <% }) %>
      </select>
    </form>

    <%- include('../partials/button', { 
        buttonType: 'export', 
        buttonLabel: 'Ekspor ke Excel', 
        buttonTarget: `/admin/monitoring/export' + (selectedTahunId ? '?tahun_ajaran=' + selectedTahunId : '')`, 
        buttonStatus: '' 
    }) %>
  </div>

  <div class="table-responsive">
    <h2 class="mb-3">Monitoring Mahasiswa</h2>
    <table class="table table-bordered table-striped text-center align-middle">
      <thead class="table-light">
        <tr>
          <th rowspan="2">No.</th>
          <th rowspan="2">NPM</th>
          <th rowspan="2" class="text-start">Nama Mahasiswa</th>
          <th colspan="2">Dokumen</th>
          <th colspan="2">Jadwal Ujian</th>
          <th colspan="2">Penguji & Surat</th>
          <th rowspan="2">Sudah Ujian</th>
        </tr>
        <tr>
          <th>Upload</th>
          <th>Verifikasi</th>
          <th>Jadwal</th>
          <th>Verifikasi</th>
          <th>Penguji</th>
          <th>Surat</th>
        </tr>
      </thead>
      <tbody>
        <% if (mahasiswaList && mahasiswaList.length > 0) { %>
          <% mahasiswaList.forEach((mhs, index) => { %>
            <tr>
              <th scope="row"><%= index + 1 %></th>
              <td><%= mhs.npm %></td>
              <td class="text-start"><%= mhs.nama %></td>

              <!-- Dokumen -->
              <td>
                <% if (mhs.uploadBerkas) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>
              <td>
                <% if (mhs.verifBerkas) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>

              <!-- Jadwal Ujian -->
              <td><%= mhs.jadwalUjian || '-' %></td>
              <td>
                <% if (mhs.jadwalUjianDone) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>

              <!-- Penguji & Surat -->
              <td>
                <% if (mhs.penguji) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>
              <td>
                <% if (mhs.suratUndangan) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>

              <!-- Sudah Ujian -->
              <td>
                <% if (mhs.sudahUjian) { %>
                  <i class="bi bi-check-circle-fill text-success fs-4"></i>
                <% } else { %>
                  <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                <% } %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="10" class="text-muted py-4">Belum ada data mahasiswa</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script>
document.getElementById("tahun_ajaran").addEventListener("change", function() {
  const filterValue = this.value;
  const baseUrl = window.location.pathname;
  const url = filterValue 
    ? `${baseUrl}?tahun_ajaran=${encodeURIComponent(filterValue)}`
    : baseUrl;
  window.location.href = url;
});
</script>
